<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>EP Template Linklist Generator â€” Modern UI</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-green-100 p-8 text-gray-800" x-data="linkGen()">

<div class="max-w-6xl mx-auto">
  <h1 class="text-3xl font-bold mb-6 text-center">EP Template Linklist Generator</h1>

  <!-- Parent Blocks -->
  <template x-for="parent in parents" :key="parent.id">
    <div class="bg-white shadow-lg rounded-xl p-5 mb-4 border">
      <div class="flex justify-between items-center mb-3">
        <label class="font-semibold text-lg">Parent Header</label>
        <button @click="removeParent(parent.id)" class="text-red-600 font-bold">âœ–</button>
      </div>

      <input x-model="parent.header" class="w-full border p-2 rounded mb-4" placeholder="Parent header..." />

      <h3 class="font-medium mb-2">Child Items</h3>
      <template x-for="child in parent.children" :key="child.id">
        <div class="flex gap-3 mb-3 items-center">

          <!-- LABEL with URL extraction -->
          <input 
            x-model="child.label" 
            class="w-1/3 border p-2 rounded" 
            placeholder="Label"
            @paste="extractURLFromPaste($event, child)"
          />

          <!-- URL -->
          <input x-model="child.url" class="w-2/3 border p-2 rounded" placeholder="URL https://..." />

          <button @click="removeChild(parent.id, child.id)" class="text-red-600 font-bold">âœ–</button>
        </div>
      </template>

      <button @click="addChild(parent.id)" class="px-3 py-1 bg-red-100 rounded hover:bg-gray-300 mt-2">Add Child</button>
    </div>
  </template>
  
  <div class="flex gap-4 mb-6">
    <button @click="addParent()" class="px-4 py-2 bg-white shadow rounded-lg hover:bg-gray-50">âž• Add Parent</button>
  </div>

  <!-- Live Preview Table -->
  <h2 class="text-xl font-semibold mt-6 mb-2">Live Preview Table</h2>
  <div class="overflow-auto border rounded-lg bg-white shadow p-4" x-show="parents.length > 0">
    <table class="min-w-full border-collapse">
      <thead>
        <tr class="bg-green-300">
          <template x-for="parent in parents" :key="parent.id">
            <th class="border px-4 py-2 text-left font-bold"><span x-text="parent.header || 'Untitled'"></span></th>
          </template>
        </tr>
      </thead>
      <tbody>
        <tr>
          <template x-for="parent in parents" :key="parent.id">
            <td class="border px-4 py-2 align-top">
              <ul class="list-disc ml-5">
                <template x-for="child in parent.children" :key="child.id">
                  <li>
                    <template x-if="child.url">
                      <a :href="normalizeURL(child.url)" x-text="child.label || 'No Label'" class="text-blue-600 underline" target="_blank"></a>
                    </template>
                    <template x-if="!child.url">
                      <span x-text="child.label || 'No Label'"></span>
                    </template>
                  </li>
                </template>
              </ul>
            </td>
          </template>
        </tr>
      </tbody>
    </table>
  </div>

  <br>
  <div>
    <button @click="generate()" class="px-4 py-2 bg-green-600 text-white shadow rounded-lg hover:bg-green-700">Generate Script</button>
    <button @click="copyOutput()" class="px-4 py-2 bg-blue-600 text-white shadow rounded-lg hover:bg-blue-700">Copy Output</button>
  </div>

  <!-- Output -->
  <h2 class="text-xl font-semibold mt-6 mb-2">Generated Output</h2>
  <textarea x-model="output" readonly class="w-full h-72 border p-3 rounded bg-gray-50 font-mono"></textarea>
</div>


<!-- ðŸŸ© DARK MODE SLIDE-IN TOAST (TOP-RIGHT) -->
<div 
  x-show="toast.show"
  x-transition:enter="transform transition ease-out duration-300"
  x-transition:enter-start="translate-x-10 opacity-0"
  x-transition:enter-end="translate-x-0 opacity-100"
  x-transition:leave="transform transition ease-in duration-300"
  x-transition:leave-start="translate-x-0 opacity-100"
  x-transition:leave-end="translate-x-10 opacity-0"
  class="fixed top-5 right-5 bg-gray-900 text-white px-4 py-2 rounded-lg shadow-xl border border-gray-700"
  x-text="toast.message">
</div>


<script>
function linkGen() {
  return {
    parents: [],
    output: "",

    toast: {
      show: false,
      message: ""
    },

    showToast(msg) {
      this.toast.message = msg;
      this.toast.show = true;

      setTimeout(() => {
        this.toast.show = false;
      }, 2500);
    },

    addParent() {
      this.parents.push({ id: Date.now() + Math.random(), header: "", children: [] });
    },

    removeParent(pid) {
      this.parents = this.parents.filter(p => p.id !== pid);
    },

    addChild(pid) {
      const parent = this.parents.find(p => p.id === pid);
      if (parent) parent.children.push({ id: Date.now() + Math.random(), label: "", url: "" });
    },

    removeChild(pid, cid) {
      const parent = this.parents.find(p => p.id === pid);
      if (parent) parent.children = parent.children.filter(c => c.id !== cid);
    },

    /* URL AUTO-DETECTION FROM PASTE */
    extractURLFromPaste(event, child) {
      const clipboard = event.clipboardData;
      if (!clipboard) return;

      // HTML hyperlink paste
      const html = clipboard.getData("text/html");
      if (html) {
        const match = html.match(/href="([^"]+)"/i);
        if (match) {
          child.url = match[1];
          this.showToast("URL auto-extracted!");
          return;
        }
      }

      // Plain text / Markdown hyperlink paste
      const text = clipboard.getData("text/plain");
      const markdownMatch = text.match(/\((https?:\/\/[^\)]+)\)/);
      if (markdownMatch) {
        child.url = markdownMatch[1];
        this.showToast("URL auto-extracted!");
        return;
      }

      // Direct URL pasted
      if (/^https?:\/\//i.test(text.trim())) {
        child.url = text.trim();
        this.showToast("URL auto-extracted!");
      }
    },

    /* Normalizes URLs */
    normalizeURL(url) {
      const clean = url
        .trim()
        .replace(/[\u200B-\u200D\uFEFF]/g, "");

      if (/^https?:\/\//i.test(clean)) return clean;
      return `https://${clean}`;
    },

    generate() {
      const columns = this.parents.map(p => ({
        header: p.header.trim(),
        linklist: p.children
          .filter(c => c.label.trim() && c.url.trim())
          .map(c => ({
              label: c.label.trim(),
              URL: this.normalizeURL(c.url)
          }))
      }));

      const obj = {
        width: "1000px",
        mainHeader: "",
        imgOverride: "",
        columns: columns
      };

      this.output = `<script type="eptemplate/linklist">${JSON.stringify(obj, null, 4)}<\/script>`;
    },

    copyOutput() {
      navigator.clipboard.writeText(this.output).then(() =>
        alert("Copied to clipboard.")
      );
    }
  };
}
</script>

</body>
</html>
